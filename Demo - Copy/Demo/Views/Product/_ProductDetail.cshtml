@model Ticket

@{
    Dictionary<string, int> cart = ViewBag.Cart;
}

<form class="form"
      data-ajax="true"
      data-ajax-update="#target"
      method="post"
      action="/Product/UpdateCart">

    @{
        var max = 10;
        var quantity = 0;
        if (cart.ContainsKey(Model.TicketID))
        {
            quantity = cart[Model.TicketID];

        }

        if (Model.Stock < max)
        {
            max = Model.Stock;
        }
        var list = new SelectList(Enumerable.Range(1, max), quantity);
    }

    <label>Type</label>
    <span>@Model.Type</span>
    <br>

    <label>Price</label>
    <span>@Model.UnitPrice</span>
    <br>

    <label>Available Seat</label>
    <span>@Model.Stock</span>
    <br>

    <label>Departure DateTime</label>
    <span>@Model.DepartureTime.ToString("dd/MM/yyyy HH:mm tt")</span>
    <br>

    <label>Source</label>
    <span>@Model.Source</span>
    <br>

    <label>Destination</label>
    <span>@Model.Destination</span>
    <br>
    <label>Source Location</label>
    <div id="map" style="height:300px; width:300px; border: 1px solid #ccc;"></div>
    <br>

    @Html.DropDownList("Quantity", list, "")
    @Html.Hidden("TicketID", Model.TicketID)
    @{
        if (cart.ContainsKey(Model.TicketID))
        {

            <span>✅</span>
        }
    }

</form>

<p>
    <button data-get="/Product/Index">Back</button>
</p>

<script>

    function initMap() {

        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 12,
            center: { lat: @Model.Location.Latitude , lng: @Model.Location.Longitude },
        });

        const marker = new google.maps.Marker({
            position: { lat: @Model.Location.Latitude, lng: @Model.Location.Longitude },
            map: map,
        });

    }
</script>


<!-- Load Google Maps JavaScript API -->
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXwE8UL4vwfkLDRSKxNWPNffzv0-MGcfo&callback=initMap">
</script>
